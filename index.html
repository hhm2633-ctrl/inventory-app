<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>솔리드옴므 아울렛 재고 조회</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <style>
    :root{
      --bg:#0b1116;
      --panel:#141b22cc;
      --ink:#e5eef7;
      --ink-dim:#9fb0c3;
      --brand:#00d2ff;
      --pill-ok:#16a34a;     /* 주문가능 */
      --pill-eta:#ca8a04;    /* 입고 예정(물류만 재고) */
      --pill-low:#f59e0b;    /* 품절임박 */
      --pill-oos:#ef4444;    /* 품절 (혹시 대비) */
      --btn:#1f2937;
      --btn-hover:#263244;
      --bd:#263244;
      --chip:#0f172a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--ink); background:#0b1116;
      font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif;
      min-height:100vh;
      background-image:url("./031.jpg");
      background-size:cover;
      background-attachment:fixed;
      background-position:center top;
    }
    .wrap{max-width:1080px;margin:24px auto;padding:0 16px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:10px}
    h1{font-size:22px;margin:0}
    .actions{display:flex;gap:10px}
    .btn{
      background:var(--btn); border:1px solid var(--bd); color:var(--ink);
      padding:10px 14px; border-radius:999px; text-decoration:none;
    }
    .btn:hover{background:var(--btn-hover)}
    .card{
      background:var(--panel); border:1px solid var(--bd); border-radius:18px;
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      padding:16px 16px;
      margin:16px 0;
    }
    .label{font-weight:700;margin-bottom:8px}
    .searchbox{
      display:flex; gap:12px; align-items:center;
      background:#0b1320; border:1px solid var(--bd); border-radius:14px; padding:12px;
    }
    .searchbox input{
      flex:1; background:transparent; border:0; outline:0; color:var(--ink); font-size:16px;
    }
    .hint{color:var(--ink-dim); font-size:12px; margin-top:8px}
    .result{padding:12px 12px}
    .group{border:1px solid var(--bd); border-radius:14px; padding:12px; margin-top:12px; background:#0b1320}
    .group-head{display:flex; align-items:center; gap:10px; justify-content:space-between}
    .code{font-weight:800; letter-spacing:.5px}
    select, .select{
      background:#0e1625; color:var(--ink); border:1px solid var(--bd);
      border-radius:10px; padding:8px 10px; min-width:120px;
    }
    .sizes{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .size-pill{
      display:flex; align-items:center; gap:8px;
      background:var(--chip); border:1px solid var(--bd); border-radius:999px;
      padding:8px 10px;
    }
    .status{font-size:12px; font-weight:700; padding:2px 8px; border-radius:999px; color:#fff}
    .s-ok{background:var(--pill-ok)}
    .s-eta{background:var(--pill-eta)}
    .s-low{background:var(--pill-low)}
    .s-oos{background:var(--pill-oos)}
    .order{margin-left:auto}
    .footer{color:var(--ink-dim); font-size:12px; text-align:center; padding:24px 6px}
    .footer a{color:var(--ink-dim); text-decoration:none; margin:0 8px}
    .ad{height:84px; border:1px dashed #2b3b52; border-radius:14px; display:flex; align-items:center; justify-content:center; color:#85a2c0; margin-top:14px}
    .sr{position:absolute;left:-9999px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>솔리드옴므 아울렛 재고 조회</h1>
      <div class="actions">
        <a class="btn" href="tel:02-2136-9886">매장 전화연결</a>
        <a class="btn" href="https://center-pf.kakao.com/_EfjEj/chats" target="_blank" rel="noopener">카카오채널 연결</a>
      </div>
    </header>

    <!-- 검색 -->
    <div class="card">
      <div class="label">검색</div>
      <div class="searchbox">
        <label class="sr" for="q">검색</label>
        <input id="q" placeholder="예: s243ts26, 로고 티셔츠…" />
        <button class="btn" id="doSearch">검색</button>
      </div>
      <div class="hint">검색은 <b>상품코드/품명</b>에 부분일치로 동작합니다.</div>
    </div>

    <!-- 결과 -->
    <div class="card">
      <div class="label">재고 결과</div>
      <div id="result" class="result"></div>
      <div class="ad">[광고 영역] 커스텀 도메인 연결 + AdSense 승인 후 스크립트를 여기에 붙이면 노출됩니다.</div>
    </div>

    <div class="footer">
      © SOLID HOMME Outlet · 재고 조회/주문 문의
      · <a href="./about.html">브랜드 소개</a>
      · <a href="./privacy.html">개인정보처리방침</a>
      · <a href="tel:02-2136-9886">매장 전화연결</a>
      · <a href="https://center-pf.kakao.com/_EfjEj/chats" target="_blank" rel="noopener">카카오채널 연결</a>
    </div>
  </div>

  <script>
    // ===== 공통 =====
    const nz = (v)=> v==null ? "" : String(v).trim();
    const norm = (s)=> nz(s).toLowerCase().replace(/\s+/g,"");

    // 사이즈 정렬 규칙(상품코드 기반)
    const SIZE_RULES = [
      { keys:["ts","tsa","sh","sha","ds","jp","jpa","dn","dna","hc","sj","cj","kn","kna","lj","lja"], order:["44","46","48","50","52"] },
      { keys:["pt","pta","sp"], order:["30","31","32","33","34","36"] },
      { keys:["su"], order:["39","40","41","42","43"] },
    ];
    function extractSizeOrder(code){
      const c = norm(code);
      for(const r of SIZE_RULES) for(const k of r.keys) if(c.includes(k)) return r.order;
      return null;
    }

    // 상태 → 클래스
    function statusClass(s){
      s = nz(s);
      if(s.includes("입고")) return "s-eta";
      if(s.includes("임박")) return "s-low";
      if(s.includes("품절")) return "s-oos";
      return "s-ok";
    }

    // ===== 데이터 로드 =====
    let ALL = [];
    fetch("./inventory.json?_="+Date.now())
      .then(r=>r.json())
      .then(arr=>{
        if(!Array.isArray(arr)) throw new Error("inventory.json 형식이 배열이 아닙니다.");
        ALL = arr.map(x=>({
          code: nz(x["상품코드"]),
          name: nz(x["품명"]),
          color: nz(x["색상"]),
          size: nz(x["사이즈"]),
          status: nz(x["상태"])
        }));
      })
      .catch(e=>{
        const el = document.getElementById("result");
        el.textContent = "inventory.json을 불러오지 못했습니다: " + e.message;
      });

    // ===== 렌더링 =====
    function renderGroups(rows){
      const wrap = document.getElementById("result");
      wrap.innerHTML = "";

      if(!rows.length){
        wrap.textContent = "검색 결과가 없습니다.";
        return;
      }

      // 그룹핑: 상품코드 → {colors → sizes}
      const byCode = new Map();
      for(const r of rows){
        if(!byCode.has(r.code)) byCode.set(r.code, []);
        byCode.get(r.code).push(r);
      }

      for(const [code, list] of byCode){
        // 색상 목록
        const colors = Array.from(new Set(list.map(x=>x.color).filter(Boolean)));
        colors.sort((a,b)=> a.localeCompare(b));

        // 사이즈 정렬
        const order = extractSizeOrder(code);
        const sizeSort = (a,b)=>{
          if(!order) return a.localeCompare(b);
          const ia = order.indexOf(a), ib = order.indexOf(b);
          const aa = ia<0? 998: ia, bb = ib<0? 998: ib;
          return aa===bb ? a.localeCompare(b) : aa-bb;
        };

        // 초기 색상
        const defaultColor = colors[0] || "";

        // 그룹 DOM
        const group = document.createElement("div");
        group.className = "group";

        const head = document.createElement("div");
        head.className = "group-head";

        const left = document.createElement("div");
        left.innerHTML = `<div class="code">${code}</div>`;

        const right = document.createElement("div");
        // 색상 선택 셀렉트
        const sel = document.createElement("select");
        for(const c of colors.length? colors: ["(색상없음)"]){
          const o = document.createElement("option");
          o.value = c; o.textContent = c || "(색상없음)";
          sel.appendChild(o);
        }
        sel.className = "select";
        sel.value = defaultColor;
        right.appendChild(sel);

        head.appendChild(left);
        head.appendChild(right);
        group.appendChild(head);

        // 사이즈 그리드
        const sizesBox = document.createElement("div");
        sizesBox.className = "sizes";
        group.appendChild(sizesBox);

        // 사이즈 렌더 함수
        function drawSizes(color){
          sizesBox.innerHTML = "";
          const rows = list.filter(x=> (x.color || "") === (color || ""));
          const sizes = Array.from(new Set(rows.map(x=>x.size))).sort(sizeSort);
          if(!sizes.length){
            const span = document.createElement("div");
            span.style.color = "#93a4ba";
            span.textContent = "선택한 색상의 사이즈 정보가 없습니다.";
            sizesBox.appendChild(span);
            return;
          }
          for(const sz of sizes){
            const item = rows.find(x=> x.size===sz);
            const pill = document.createElement("div");
            pill.className = "size-pill";
            const tag = document.createElement("span");
            tag.textContent = sz;
            const st = document.createElement("span");
            st.className = "status " + statusClass(item?.status||"");
            st.textContent = item?.status || "정보없음";
            pill.appendChild(tag);
            pill.appendChild(st);
            sizesBox.appendChild(pill);
          }
        }
        drawSizes(defaultColor);
        sel.addEventListener("change", ()=> drawSizes(sel.value));

        wrap.appendChild(group);
      }
    }

    // ===== 검색 =====
    function search(){
      const q = norm(document.getElementById("q").value);
      if(!q){ document.getElementById("result").textContent = "검색어를 입력하세요."; return; }
      // 상품코드/품명 부분일치
      const out = ALL.filter(r=> norm(r.code).includes(q) || norm(r.name).includes(q));
      renderGroups(out);
    }
    document.getElementById("doSearch").addEventListener("click", search);
    document.getElementById("q").addEventListener("keydown", e=>{
      if(e.key==="Enter") search();
    });
  </script>
</body>
</html>
