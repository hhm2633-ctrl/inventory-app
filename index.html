<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>솔리드옴므 아울렛 재고 조회</title>
<link rel="manifest" href="manifest.webmanifest?v=8" />
<style>
  :root { --bg:#0b0f14; --card:#121820; --muted:#94a3b8; --fg:#e8eef6; --accent:#5bbcff;
          --ok:#16a34a; --warn:#d97706; --bad:#ef4444; --incoming:#3b82f6; }
  html,body{margin:0;padding:0;background:#0b0f14;color:var(--fg);
            font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;}
  .wrap{max-width:1100px;margin:28px auto;padding:0 16px;}
  h1{margin:0 0 20px 0;font-size:28px;}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{background:#111827;border:1px solid #273547;color:#d9e7ff;padding:10px 14px;border-radius:12px;cursor:pointer}
  .search{width:100%;padding:14px 16px;border-radius:14px;border:1px solid #273547;background:#0f1620;color:var(--fg);font-size:18px;}
  .card{background:linear-gradient(180deg,#121820,#0d1420);border:1px solid #1c2430;border-radius:16px;padding:18px;}
  .pill{border:1px solid #2a3950;background:#0f172a;color:#cfe8ff;border-radius:999px;padding:6px 10px;font-size:13px}
  .state{display:inline-block;border-radius:16px;padding:6px 12px;font-size:14px;border:1px solid transparent;
         cursor:pointer; background:#0f172a; color:#cfe8ff}
  .state.ok{background:#0f2b1b;border-color:#1f5c37;color:#b9f7d5}
  .state.warn{background:#2c1e0a;border-color:#7a4d17;color:#ffe4b5}
  .state.bad{background:#3a0f14;border-color:#7a1d22;color:#ffc9c9; cursor:default}
  .state.incoming{background:#0f1a3a;border-color:#3d4aac;color:#d2d8ff; cursor:default}
  .state:disabled{opacity:.6;cursor:not-allowed}
  .sizeCol{display:flex;flex-direction:column;gap:10px}
  .sizeItem{display:flex;align-items:center;gap:12px}
  .sizeTag{min-width:46px;text-align:center;border:1px solid #2a3950;border-radius:12px;padding:6px 10px;background:#0e1726;color:#cfe8ff}
  .grid{display:grid;grid-template-columns:1fr 210px 1fr auto;gap:12px;align-items:center}
  .select{padding:10px 12px;border-radius:10px;border:1px solid #273547;background:#0e1622;color:var(--fg)}
  .price{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .price .now{font-weight:800;font-size:18px}
  .price .orig{color:#a8b5c6;text-decoration:line-through}
  .price .rate{color:#9fe4b0}
  footer{margin:30px 0;color:#9aa7b8;font-size:14px;display:flex;gap:16px;flex-wrap:wrap;justify-content:flex-end}
  .hero{position:fixed;inset:0;z-index:-1;background:url('031.jpg') center/cover no-repeat;filter:brightness(.35)}
  .modalBack{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:9999}
  .modal{width:min(680px,92vw);background:#101622;border:1px solid #1e2a3a;border-radius:16px;padding:18px}
  .modal h3{margin:0 0 8px 0}
  .muted{color:#a1a8b5}
  .copy{border:1px dashed #2e3c52;border-radius:10px;padding:10px 12px;background:#0f172a}
  .note{background:#0e1522;border:1px solid #203047;border-radius:12px;padding:12px}
  .small{font-size:13px;color:#9fb0c6}
  input.txt, textarea.txt{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2a3950;background:#0f172a;color:#e7f0ff}
  textarea.txt{min-height:74px;resize:vertical}
  .label{font-size:13px;color:#9fb0c6;margin:8px 0 4px}
</style>
</head>
<body>
<div class="hero"></div>
<div class="wrap">
  <div class="row" style="justify-content:flex-end;gap:10px;margin-bottom:6px">
    <a class="btn" href="tel:0221369886">매장 전화연결</a>
    <a class="btn" href="https://center-pf.kakao.com/_EfjEj/chats" target="_blank" rel="noopener">카카오채널 연결</a>
  </div>

  <h1>솔리드옴므 아울렛 재고 조회</h1>

  <div class="card" style="margin-bottom:16px">
    <div class="row" style="gap:10px">
      <input id="q" class="search" placeholder="예: s243ts26, 로고 티셔츠…" />
      <button class="btn" id="srchBtn">검색</button>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 12px 0">재고 결과</h3>
    <div id="result"></div>
  </div>

  <footer>
    <a href="about.html">브랜드 소개</a>
    <a href="privacy.html">개인정보처리방침</a>
    <a href="tel:0221369886">매장 전화연결</a>
    <a href="https://center-pf.kakao.com/_EfjEj/chats" target="_blank" rel="noopener">카카오채널 연결</a>
  </footer>
</div>

<!-- 주문 모달 -->
<div id="orderBack" class="modalBack" onclick="closeOrder(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <h3>주문 방식 안내</h3>
    <div id="orderInfo" class="muted" style="margin-bottom:10px"></div>

    <div class="note small" style="margin:8px 0 12px 0">
      <div>• <b>택배비</b> : <b>40만원 이상 무료</b> / 그 이하 <b>3,000원</b></div>
      <div>• <b>교환/반품</b> : 수령 후 7일 이내, 택 제거/착용 흔적/오염 없을 때 가능 (왕복택배비 <b>7,000원</b>)</div>
      <div>• <b>유의</b> : 오프라인 재고 연동으로 결제 후 품절이 발생할 수 있어요. 이 경우 <b>전액 환불</b>됩니다.</div>
    </div>

    <div class="row" style="gap:10px;margin:8px 0 14px 0">
      <button class="btn" onclick="showBank()">계좌이체로 주문</button>
      <button class="btn" onclick="showCard()">카드결제로 주문</button>
    </div>

    <!-- 계좌이체 영역 -->
    <div id="bankBox" style="display:none">
      <div class="copy" style="margin-bottom:8px">
        <div><b>입금 계좌</b></div>
        <div id="bankText">국민 616 701 01 634455 솔리드(한홍명)</div>
      </div>

      <div class="label">입금자 성명</div>
      <input id="depositor" class="txt" placeholder="예: 홍길동" oninput="updateBankMemo()" />

      <div class="label">수령자 이름</div>
      <input id="recvName" class="txt" placeholder="예: 김솔리드" oninput="updateBankMemo()" />

      <div class="label">연락처</div>
      <input id="recvPhone" class="txt" placeholder="예: 010-1234-5678" oninput="updateBankMemo()" />

      <div class="label">주소</div>
      <textarea id="recvAddr" class="txt" placeholder="도로명주소 + 상세주소" oninput="updateBankMemo()"></textarea>

      <div class="label">요청사항</div>
      <textarea id="recvNote" class="txt" placeholder="배송 관련 메모" oninput="updateBankMemo()"></textarea>

      <div class="copy" style="margin-top:10px">
        <div><b>주문 메모</b> (카카오 채널에 붙여넣기)</div>
        <pre id="bankMemo" style="white-space:pre-wrap;margin:6px 0 0 0"></pre>
      </div>
      <div class="row" style="gap:8px;margin-top:8px">
        <button class="btn" onclick="copyBank()">계좌 복사</button>
        <button class="btn" onclick="copyBankMemo()">메모 복사</button>
        <button class="btn" onclick="sendBankMemo()">카카오채널로 전송</button>
        <button class="btn" onclick="showPending()">이체완료</button>
      </div>
    </div>

    <!-- 카드결제 영역 -->
    <div id="cardBox" style="display:none">
      <div class="copy" style="margin-bottom:8px">
        <div><b>주문 메모</b> (카카오 채널에 붙여넣기)</div>
        <pre id="memo" style="white-space:pre-wrap;margin:6px 0 0 0"></pre>
      </div>
      <div class="row" style="gap:8px;margin-top:4px">
        <button class="btn" onclick="copyMemo()">메모 복사</button>
        <button class="btn" onclick="sendMemo()">카카오채널로 전송</button>
        <button class="btn" onclick="showPending()">결제완료</button>
      </div>
      <div class="muted small" style="margin-top:8px">* 상담원이 결제 링크를 안내해 드립니다.</div>
    </div>

    <div class="row" style="justify-content:flex-end;margin-top:14px">
      <button class="btn" onclick="closeOrder()">닫기</button>
    </div>
  </div>
</div>

<!-- 공통 '주문 확인중' 모달 -->
<div id="pendingBack" class="modalBack" onclick="closePending(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <h3>주문 확인중</h3>
    <div class="muted" style="margin-bottom:10px; white-space:pre-wrap">
영업시간 10:30~21:00 실시간 매장확인 연락드리며
영업시간 이후 21:00~ 다음날 매장 오픈 이후 순차적으로 연락드립니다.
결제/이체 확인 후 순차적으로 연락드리겠습니다. 카카오 채널 알림을 확인해 주세요.

택배비 안내 40만원 이상 구매시 무료배송 그이하 3,000 원 
단순 변심 교환 왕복 택배비 7,000원
국민 616 701 01 634455 솔리드(한홍명)

교환정책 

제품 수령 후 교환은 1주일 이내로 가능 합니다.
    </div>
    <div class="row" style="justify-content:flex-end">
      <button class="btn" onclick="closePending()">확인</button>
    </div>
  </div>
</div>

<script>
const INV_URL = `inventory.json?v=${Date.now()}`;
const KAKAO_CHAT = 'https://center-pf.kakao.com/_EfjEj/chats';

const $ = s => document.querySelector(s);
const nz = v => (v==null ? '' : String(v).trim());

function normalizeRow(r){
  const out = {...r};
  if (out['매장재고']==null && out['매장합']!=null) out['매장재고']=out['매장합'];
  if (out['창고재고']==null && out['물류합']!=null) out['창고재고']=out['물류합'];
  if (out['전체재고']==null && out['전체합']!=null) out['전체재고']=out['전체합'];
  if (out['소비자가']==null && out['할인전가격']!=null) out['소비자가']=out['할인전가격'];
  if (out['할인율']==null && out['할인율(%)']!=null) out['할인율']=out['할인율(%)'];
  return out;
}
function toInt(v, d=0){
  try{
    const s = String(v??'').replace(/[^\d-]/g,'').trim();
    if (!s || s==='-') return d;
    return parseInt(s,10);
  }catch{ return d; }
}
function fmtWon(v){ return (v==null||v==='') ? '' : Number(v).toLocaleString()+'원'; }

function decideState(store, wh, total){
  store = +store||0; wh=+wh||0; total=+total||0;
  if (store>=1 && wh>=1) return {label:'주문가능', cls:'ok'};
  if (store==0 && wh>=1) return {label:'주문불가(미입고)', cls:'incoming'};
  if (total<=9) return {label:'품절임박', cls:'warn'};
  if (store>=1) return {label:'주문가능', cls:'ok'};
  if (store==0 && wh==0) return {label:'주문불가', cls:'bad'};
  return {label:'주문가능', cls:'ok'};
}

let INV = [];
async function load(){
  const res = await fetch(INV_URL, {cache:'no-store'});
  const data = await res.json();
  INV = Array.isArray(data)? data.map(normalizeRow): [];
}
function groupByStyle(rows){
  const map = new Map();
  for (const r of rows){
    const code = nz(r['상품코드']).toUpperCase();
    const color = nz(r['색상']);
    const size  = nz(r['사이즈']);
    if (!map.has(code)) map.set(code, {code, colors:new Map()});
    const entry = map.get(code);
    if (entry){
      if (!entry.colors.has(color)) entry.colors.set(color, []);
      entry.colors.get(color).push(r);
    }
  }
  const orderRTW   = ['44','46','48','50','52','54'];
  const orderPants = ['28','30','31','32','33','34','36'];
  const orderShoes = ['39','40','41','42','43'];
  const getIdx=(s)=>{
    if (orderRTW.includes(s))   return orderRTW.indexOf(s);
    if (orderPants.includes(s)) return orderPants.indexOf(s)+100;
    if (orderShoes.includes(s)) return orderShoes.indexOf(s)+200;
    return 999;
  };
  for (const [,v] of map){
    for (const [c, arr] of v.colors){
      arr.sort((a,b)=> getIdx(nz(a['사이즈'])) - getIdx(nz(b['사이즈'])));
      v.colors.set(c, arr);
    }
  }
  return map;
}

function computePrice(rows){
  const r0 = rows.find(r=> r['판매가']!=null || r['소비자가']!=null || r['할인율']!=null) || {};
  let p = toInt(r0['판매가'], null);
  let q = toInt(r0['소비자가'], null);
  let r = r0['할인율']!=null ? Number(r0['할인율']) : null;

  if ((r==null || Number.isNaN(r)) && p!=null && q!=null && q>0){
    r = Math.round((1 - p/q) * 1000)/10;
  }
  if ((q==null || q===0) && p!=null && r!=null){
    q = Math.round(p / (1 - r/100));
  }
  return {p, q, r};
}

function priceHTML(rows){
  const {p,q,r} = computePrice(rows);
  if (p==null && q==null) return `<div class="pill">가격 정보 없음</div>`;
  const a = [];
  if (q!=null) a.push(`<span class="orig">${fmtWon(q)}</span>`);
  if (p!=null) a.push(`<span class="now">${fmtWon(p)}</span>`);
  if (r!=null) a.push(`<span class="rate">(-${r}%)</span>`);
  return `<div class="price">${a.join(' ')}</div>`;
}

function render(list){
  if (!list.length){ $('#result').innerHTML = `<div style="color:#9aa7b8">검색 결과가 없습니다.</div>`; return; }

  const g = groupByStyle(list);
  const blocks = [];

  for (const [, item] of g){
    const colors = Array.from(item.colors.keys());
    const colorSelId = 'color_'+Math.random().toString(36).slice(2,8);
    const firstColor = colors[0] || '(색상없음)';
    const firstRows  = item.colors.get(firstColor) || [];

    const head = `
      <div class="grid" style="margin:6px 0 12px 0">
        <div><div class="pill" style="font-weight:700;font-size:18px">${item.code}</div></div>
        <div>
          <select id="${colorSelId}" class="select">
            ${colors.map(c=>`<option value="${c}">${c || '(색상없음)'}</option>`).join('')}
          </select>
        </div>
        <div id="${colorSelId}_price">${priceHTML(firstRows)}</div>
        <div><button class="btn" onclick="openOrder('${item.code}','${firstColor}','')">주문</button></div>
      </div>
      <div id="${colorSelId}_sizes" class="sizeCol"></div>
    `;
    blocks.push(`<div style="border-top:1px solid #1c2430;padding-top:12px;margin-top:12px">${head}</div>`);

    setTimeout(()=> {
      updateSizes(colorSelId, item, firstColor);
      const sel = document.getElementById(colorSelId);
      sel?.addEventListener('change', (e)=>{
        const c = e.target.value;
        updateSizes(colorSelId, item, c);
        document.getElementById(colorSelId+'_price').innerHTML = priceHTML(item.colors.get(c)||[]);
      });
    }, 0);
  }

  $('#result').innerHTML = blocks.join('');
}

// ★ 클릭 핸들러 직접 연결 버전
function updateSizes(id, item, color){
  const box = document.getElementById(id+'_sizes');
  const rows = item.colors.get(color)||[];

  if (!rows.length){
    box.innerHTML = `<div class="sizeItem"><span class="sizeTag">-</span><span class="state bad">주문불가</span></div>`;
    return;
  }
  const html = rows.map(r=>{
    const size = nz(r['사이즈']) || '-';
    const st = decideState(r['매장재고'], r['창고재고'], r['전체재고']);
    const clickable = (st.cls==='ok' || st.cls==='warn');
    const baseAttr = `data-style="${item.code}" data-color="${color}" data-size="${size}"`;

    return `<div class="sizeItem">
              <span class="sizeTag">${size}</span>
              <span class="state ${st.cls}" ${baseAttr}
                    ${clickable ? 'onclick="handleStateClick(this)" role="button" tabindex="0"' : 'aria-disabled="true"'}>${st.label}</span>
            </div>`;
  }).join('');
  box.innerHTML = html;
}

// 상태 뱃지 클릭 → 주문 모달
function handleStateClick(el){
  const style = el.getAttribute('data-style');
  const color = el.getAttribute('data-color');
  const size  = el.getAttribute('data-size');
  openOrder(style,color,size);
}

// 검색
async function search(){
  const q = nz($('#q').value).toLowerCase();
  const rows = INV.filter(r=>{
    const code = nz(r['상품코드']).toLowerCase();
    const name = nz(r['품명']).toLowerCase();
    return q ? (code.includes(q) || name.includes(q)) : false;
  });
  render(rows);
}
$('#srchBtn').addEventListener('click', search);
$('#q').addEventListener('keydown', (e)=>{ if (e.key==='Enter') search(); });

// ----- 주문 모달 -----
let selStyle='', selColor='', selSize='';
function openOrder(style,color,size){
  selStyle=style; selColor=color; selSize=size;
  $('#orderInfo').textContent = `선택: ${style} ${color || ''} ${size || ''}`.trim();
  $('#bankBox').style.display='none';
  $('#cardBox').style.display='none';
  $('#memo').textContent = makeCardMemo();
  updateBankMemo();
  $('#orderBack').style.display='flex';
}
function closeOrder(){ $('#orderBack').style.display='none'; }
function showBank(){ $('#cardBox').style.display='none'; $('#bankBox').style.display='block'; updateBankMemo(); }
function showCard(){ $('#bankBox').style.display='none'; $('#cardBox').style.display='block'; $('#memo').textContent = makeCardMemo(); }

// --- 계좌이체 흐름 ---
function copyBank(){
  const t = $('#bankText').textContent;
  navigator.clipboard.writeText(t).then(()=> alert('계좌를 복사했습니다.'));
}
function makeBankMemo(){
  const dep = nz($('#depositor').value);
  const name = nz($('#recvName').value);
  const phone = nz($('#recvPhone').value);
  const addr = nz($('#recvAddr').value);
  const note = nz($('#recvNote').value);

  return (
`[계좌이체 주문 요청]
상품코드: ${selStyle}
색상: ${selColor || '(선택)'}
사이즈: ${selSize || '(선택)'}

입금자 성명: ${dep || '(입력)'}
입금 계좌: 국민 616 701 01 634455 솔리드(한홍명)

[받는분 정보]
이름: ${name}
연락처: ${phone}
주소: ${addr}
요청사항: ${note}

* 이체 후 확인 부탁드립니다.`
  );
}
function updateBankMemo(){ $('#bankMemo').textContent = makeBankMemo(); }
function copyBankMemo(){ navigator.clipboard.writeText($('#bankMemo').textContent).then(()=> alert('주문 메모를 복사했습니다.')); }
function sendBankMemo(){ const t = $('#bankMemo').textContent; window.open(KAKAO_CHAT + '?message=' + encodeURIComponent(t), '_blank'); }

// --- 카드 결제 흐름 ---
function makeCardMemo(){
  return (
`[카드결제 주문 요청]
상품코드: ${selStyle}
색상: ${selColor || '(선택)'}
사이즈: ${selSize || '(선택)'}
수령방법: 택배(착불/선불 중 선택)

[받는분 정보]
이름:
연락처:
주소:
요청사항:

* 재고 확인 후 결제 링크 부탁드립니다.`
  );
}
function copyMemo(){ const t = $('#memo').textContent; navigator.clipboard.writeText(t).then(()=> alert('메모를 복사했습니다.')); }
function sendMemo(){ const t = $('#memo').textContent; window.open(KAKAO_CHAT + '?message=' + encodeURIComponent(t), '_blank'); }

// 공통 완료
function showPending(){ closeOrder(); $('#pendingBack').style.display='flex'; }
function closePending(){ $('#pendingBack').style.display='none'; }

load().then(()=>{}).catch(()=>{});
</script>
</body>
</html>
