<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì†”ë¦¬ë“œì˜´ë¯€ ì•„ìš¸ë › ì¬ê³  ì¡°íšŒ</title>

<meta name="theme-color" content="#0b0f14" />
<link rel="manifest" href="manifest.webmanifest" />
<link rel="icon" sizes="192x192" href="icons/icon-192.png" />
<link rel="apple-touch-icon" href="icons/icon-192.png" />

<style>
  :root { --bg:#0b0f14; --card:#121820; --muted:#7a8593; --fg:#e8eef6; --accent:#5bbcff; }
  html,body { margin:0; padding:0; background:var(--bg); color:var(--fg); font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif; }
  header { padding:16px 20px; border-bottom:1px solid #1c2430; display:flex; gap:12px; align-items:center; flex-wrap:wrap; justify-content:space-between; }
  header h1 { margin:0; font-size:20px; letter-spacing:.2px; }
  .pills { display:flex; gap:8px; flex-wrap:wrap; }
  .pill { background:#0f1620; border:1px solid #233042; padding:8px 12px; border-radius:100px; color:#cfe1ff; text-decoration:none; }
  .pill:hover { border-color:#355079; }
  .container { padding:16px; display:grid; gap:16px; max-width:980px; margin:0 auto; }
  .card { background:var(--card); border:1px solid #1c2430; border-radius:14px; padding:14px; }
  .card h2 { margin:0 0 10px 0; font-size:16px; }
  .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .search { width:100%; padding:12px 14px; border-radius:10px; border:1px solid #273547; background:#0f1620; color:var(--fg); }
  .btn { background:linear-gradient(180deg,#1c2735,#151e2a); border:1px solid #273547; color:#d9e7ff; padding:8px 12px; border-radius:10px; cursor:pointer; text-decoration:none; }
  .btn:disabled { opacity:.5; cursor:not-allowed; }
  .badge { display:inline-block; padding:4px 8px; border-radius:9px; font-size:12px; border:1px solid #2a3950; color:#cfe8ff; }
  .ok { background:#12321f; border-color:#1f5c37; color:#c6ffdf; }
  .warn { background:#33240f; border-color:#6b4b17; color:#ffe1b8; }
  .incoming { background:#1e2240; border-color:#3d4aac; color:#d2d8ff; }
  .product { display:grid; gap:12px; border:1px solid #1c2430; border-radius:12px; padding:12px; }
  .product-head { display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; }
  .title { font-size:16px; font-weight:700; font-family:ui-monospace,Menlo,Consolas,monospace; }
  .controls { display:flex; gap:8px; align-items:center; }
  .select { padding:8px 10px; border-radius:10px; border:1px solid #273547; background:#0f1620; color:var(--fg); }
  .sizes { display:grid; gap:6px; }
  .size-row { display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 10px; border:1px solid #223044; border-radius:10px; background:#0f1620; }
  .size-left { display:flex; gap:10px; align-items:center; }
  .size-chip { min-width:40px; text-align:center; border:1px solid #314257; border-radius:8px; padding:4px 8px; color:#dfe9ff; }
  .ads { background:#0f1620; border:1px dashed #243349; border-radius:12px; padding:14px; color:#9eb0c8; text-align:center; }
  footer { margin:24px auto; max-width:980px; padding:12px 16px; color:#9fb1c8; border-top:1px solid #1c2430; display:flex; gap:12px; flex-wrap:wrap; justify-content:space-between; font-size:13px; }
  footer a { color:#9fbef6; text-decoration:none; }
  footer a:hover { text-decoration:underline; }
</style>
</head>
<body>
  <header>
    <h1>ì†”ë¦¬ë“œì˜´ë¯€ ì•„ìš¸ë › ì¬ê³  ì¡°íšŒ</h1>
    <div class="pills">
      <a class="pill" href="tel:0221369886">ë§¤ì¥ ì „í™”ì—°ê²°</a>
      <a class="pill" href="https://center-pf.kakao.com/_EfjEj/chats" target="_blank" rel="noopener">ì¹´ì¹´ì˜¤ì±„ë„ ì—°ê²°</a>
    </div>
  </header>

  <div class="container">
    <div class="card">
      <h2>ê²€ìƒ‰</h2>
      <div class="row">
        <input id="q" class="search" placeholder="ì˜ˆ: s243ts26, ë¡œê³  í‹°ì…”ì¸ â€¦" />
        <button id="installBtn" class="btn" style="display:none;">ì•± ì„¤ì¹˜</button>
      </div>
      <!-- ğŸ”¸ ìš”ì²­ëŒ€ë¡œ: ê²€ìƒ‰ì¹¸ ì•„ë˜ ì„¤ëª…/ì£¼ì„ ì œê±° -->
    </div>

    <div class="card">
      <h2>ì¬ê³  ê²°ê³¼</h2>
      <div id="results" class="grid" style="display:grid; gap:12px;"></div>
      <div id="nores" style="display:none; color:#9fb1c8;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
      <div style="height:10px"></div>
      <div style="color:#9fb1c8;">â€» â€œì£¼ë¬¸â€ ë²„íŠ¼ì€ Google Formsë¡œ ì´ë™í•˜ë©°, ìƒí’ˆì •ë³´ê°€ ìë™ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤.</div>
    </div>

    <div class="card">
      <div class="ads" id="ad-placeholder">
        [ê´‘ê³  ì˜ì—­] ì»¤ìŠ¤í…€ ë„ë©”ì¸ ì—°ê²° + AdSense ìŠ¹ì¸ í›„ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì—¬ê¸°ì— ë¶™ì´ë©´ ë…¸ì¶œë©ë‹ˆë‹¤.
      </div>
    </div>
  </div>

  <footer>
    <div>Â© SOLID HOMME Outlet Â· ì¬ê³  ì¡°íšŒ/ì£¼ë¬¸ ë¬¸ì˜</div>
    <div style="display:flex; gap:12px; flex-wrap:wrap;">
      <a href="./about.html">ë¸Œëœë“œ ì†Œê°œ</a>
      <a href="./privacy.html">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
      <a href="tel:0221369886">ë§¤ì¥ ì „í™”ì—°ê²°</a>
      <a href="https://center-pf.kakao.com/_EfjEj/chats" target="_blank" rel="noopener">ì¹´ì¹´ì˜¤ì±„ë„ ì—°ê²°</a>
    </div>
  </footer>

<script>
/* ===== ì„¤ì •: êµ¬ê¸€í¼ ===== */
const GOOGLE_FORM_BASE = "https://docs.google.com/forms/d/e/FORM_ID/viewform";
const FORM_ENTRY = {
  ìƒí’ˆì½”ë“œ: "entry.1111111111",
  í’ˆëª…:    "entry.2222222222",
  ìƒ‰ìƒ:    "entry.3333333333",
  ì‚¬ì´ì¦ˆ:  "entry.4444444444",
  ìˆ˜ëŸ‰:    "entry.5555555555"
};

/* ===== ë°ì´í„° URL ===== */
const JSON_URL = "./inventory.json";

/* ===== ìœ í‹¸ ===== */
const nz = (v)=> (v==null?"":String(v).trim());
function badgeClass(st){
  if (st==="ì£¼ë¬¸ê°€ëŠ¥") return "badge ok";
  if (nz(st).startsWith("ì…ê³  ì˜ˆì •")) return "badge incoming";
  if (st==="í’ˆì ˆì„ë°•") return "badge warn";
  return "badge";
}
function buildOrderLink(row){
  const p = new URL(GOOGLE_FORM_BASE);
  p.searchParams.set("usp","pp_url");
  p.searchParams.set(FORM_ENTRY.ìƒí’ˆì½”ë“œ, nz(row["ìƒí’ˆì½”ë“œ"]));
  p.searchParams.set(FORM_ENTRY.í’ˆëª…, nz(row["í’ˆëª…"]));
  p.searchParams.set(FORM_ENTRY.ìƒ‰ìƒ, nz(row["ìƒ‰ìƒ"]));
  p.searchParams.set(FORM_ENTRY.ì‚¬ì´ì¦ˆ, nz(row["ì‚¬ì´ì¦ˆ"]));
  p.searchParams.set(FORM_ENTRY.ìˆ˜ëŸ‰, "1");
  return p.toString();
}

/* ===== ì „ì—­ ===== */
let ALL_ROWS = [];
let GROUPS = [];   // [{code,name,colors:[{color,items[]}]}]
let VIEW_LIST = [];

/* ===== ë°ì´í„° ë¡œë”© ===== */
async function loadData(){
  try{
    const res = await fetch(JSON_URL, {cache:"no-store"});
    const data = await res.json();
    ALL_ROWS = Array.isArray(data.rows)? data.rows: [];
  }catch(e){
    try{
      const res = await fetch(JSON_URL);
      const data = await res.json();
      ALL_ROWS = Array.isArray(data.rows)? data.rows: [];
    }catch(e2){
      ALL_ROWS = [];
    }
  }
  buildGroups();
  applySearch("");
}

function buildGroups(){
  const byCode = new Map();
  for(const r of ALL_ROWS){
    const code = nz(r["ìƒí’ˆì½”ë“œ"]); if(!code) continue;
    const name = nz(r["í’ˆëª…"]);
    const color = nz(r["ìƒ‰ìƒ"]);
    if(!byCode.has(code)){
      byCode.set(code, { code, name, colors:new Map() });
    }
    const bucket = byCode.get(code);
    if(!bucket.colors.has(color)) bucket.colors.set(color, []);
    bucket.colors.get(color).push(r);
  }
  GROUPS = Array.from(byCode.values()).map(g=>{
    const colors = Array.from(g.colors.entries()).map(([color, items])=>{
      items = items.slice().sort((a,b)=>{
        const av = nz(a["ì‚¬ì´ì¦ˆ"]), bv = nz(b["ì‚¬ì´ì¦ˆ"]);
        const ai = parseInt(av,10), bi = parseInt(bv,10);
        if(!isNaN(ai) && !isNaN(bi) && ai!==bi) return ai-bi;
        return av.localeCompare(bv);
      });
      return { color, items };
    }).sort((a,b)=> a.color.localeCompare(b.color));
    return { code:g.code, name:g.name, colors };
  });
}

/* ===== ë Œë” ===== */
function render(){
  const root = document.getElementById("results");
  const empty = document.getElementById("nores");
  root.innerHTML = "";
  if(!VIEW_LIST.length){ empty.style.display="block"; return; }
  empty.style.display="none";

  for(const prod of VIEW_LIST){
    const wrap = document.createElement("div");
    wrap.className = "product";

    const head = document.createElement("div");
    head.className = "product-head";

    const left = document.createElement("div");
    /* ğŸ”¸ ìš”ì²­ëŒ€ë¡œ: í’ˆëª… í‘œì‹œ ì œê±°, í’ˆë²ˆë§Œ í¬ê²Œ */
    left.innerHTML = `<div class="title">${nz(prod.code)}</div>`;

    const right = document.createElement("div");
    right.className = "controls";
    const sel = document.createElement("select");
    sel.className = "select";
    for(const c of prod.colors){
      const opt = document.createElement("option");
      opt.value = c.color; opt.textContent = c.color || "(ìƒ‰ìƒì—†ìŒ)";
      sel.appendChild(opt);
    }
    right.appendChild(sel);

    head.appendChild(left);
    head.appendChild(right);
    wrap.appendChild(head);

    const sizes = document.createElement("div");
    sizes.className = "sizes";
    wrap.appendChild(sizes);

    function drawSizes(colorValue){
      sizes.innerHTML = "";
      const colorBucket = prod.colors.find(c=> c.color===colorValue) || prod.colors[0];
      for(const r of (colorBucket?.items||[])){
        const line = document.createElement("div");
        line.className = "size-row";

        const l = document.createElement("div");
        l.className = "size-left";
        const sizeChip = document.createElement("div");
        sizeChip.className = "size-chip";
        sizeChip.textContent = nz(r["ì‚¬ì´ì¦ˆ"])||"-";
        const badge = document.createElement("span");
        badge.className = badgeClass(nz(r["ìƒíƒœ"]));
        badge.textContent = nz(r["ìƒíƒœ"]);
        l.appendChild(sizeChip);
        l.appendChild(badge);

        const order = document.createElement("a");
        order.className = "btn";
        order.target = "_blank"; order.rel = "noopener";
        order.textContent = "ì£¼ë¬¸";
        order.href = buildOrderLink({
          "ìƒí’ˆì½”ë“œ": r["ìƒí’ˆì½”ë“œ"],
          "í’ˆëª…": r["í’ˆëª…"],
          "ìƒ‰ìƒ": colorBucket?.color || r["ìƒ‰ìƒ"],
          "ì‚¬ì´ì¦ˆ": r["ì‚¬ì´ì¦ˆ"]
        });

        line.appendChild(l);
        line.appendChild(order);
        sizes.appendChild(line);
      }
    }

    sel.addEventListener("change", (e)=> drawSizes(e.target.value));
    drawSizes(sel.value || (prod.colors[0]?.color ?? ""));
    root.appendChild(wrap);
  }
}

function applySearch(q){
  const qq = nz(q).toLowerCase();
  if(!qq){
    VIEW_LIST = GROUPS.slice(0,200);
  }else{
    VIEW_LIST = GROUPS.filter(g=>{
      const code = nz(g.code).toLowerCase();
      const name = nz(g.name).toLowerCase();
      return code.includes(qq) || name.includes(qq); // ê²€ìƒ‰ì€ ê·¸ëŒ€ë¡œ(í’ˆëª…ë„ í—ˆìš©)
    }).slice(0,200);
  }
  render();
}

/* ì´ë²¤íŠ¸ */
document.getElementById("q").addEventListener("input", (e)=> applySearch(e.target.value));

/* PWA */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", async () => {
    try { await navigator.serviceWorker.register("./service-worker.js"); } catch(e){}
  });
}
let deferredPrompt=null;
window.addEventListener("beforeinstallprompt", (e)=>{ e.preventDefault(); deferredPrompt=e; const b=document.getElementById("installBtn"); if(b) b.style.display="inline-block"; });
document.getElementById("installBtn")?.addEventListener("click", async ()=>{
  if(!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; document.getElementById("installBtn").style.display="none";
});

/* ì‹œì‘ */
loadData();
</script>
</body>
</html>
